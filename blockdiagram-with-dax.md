การสร้าง Block Diagram ที่สามารถเปลี่ยนสีได้แบบไดนามิกใน Power BI เป็นเทคนิคที่ทรงพลังมากในการนำเสนอสถานะของโปรเจกต์หรือกระบวนการต่างๆ เช่น Digital Transformation Readiness ที่คุณยกตัวอย่างมา

เนื่องจาก Power BI ไม่มี Visual "Block Diagram" โดยตรง เราจะใช้วิธีการประยุกต์โดยใช้ **Shapes (รูปทรง)** ร่วมกับ **DAX Measure** เพื่อควบคุมสีแบบมีเงื่อนไข (Conditional Formatting)

นี่คือวิธีการและลำดับขั้นตอนอย่างละเอียดครับ

---

### ภาพรวมของแนวทาง
1.  **เตรียมข้อมูล:** สร้างตารางข้อมูลที่ระบุชื่อกระบวนการ (Block) และสถานะ (Status) ของแต่ละกระบวนการ
2.  **สร้าง Measure ด้วย DAX:** เขียนสูตร DAX เพื่อสร้าง Measure ที่จะคืนค่าเป็นรหัสสี (Hex Code) ตามสถานะของแต่ละกระบวนการ
3.  **ออกแบบ Diagram:** นำ Shape สี่เหลี่ยมมาวางบน Report Canvas เพื่อสร้างเป็น Block Diagram ตามที่ต้องการ
4.  **ใช้ Conditional Formatting:** นำ Measure ที่สร้างไว้ในข้อ 2 มาผูกกับสีของ Shape แต่ละอัน เพื่อให้สีเปลี่ยนไปตามข้อมูลโดยอัตโนมัติ

---

### ขั้นตอนที่ 1: เตรียมข้อมูลของคุณ

ก่อนอื่น คุณต้องมีตารางข้อมูลใน Power BI ที่มีโครงสร้างลักษณะนี้ สมมติว่าชื่อตารางคือ `DT_Readiness`

| ProcessName | Status |
| :--- | :--- |
| การจัดการเอกสาร | มีความพร้อมแล้ว |
| การอนุมัติคำสั่งซื้อ | มีแผนจะปรับ |
| ระบบบัญชีเจ้าหนี้ | ล้มเหลว |
| การจัดการลูกค้าสัมพันธ์ | ไม่สามารถปรับได้ |
| การวิเคราะห์ข้อมูลการขาย | มีความพร้อมแล้ว |

**ความหมายของสี:**
*   **เทา:** `ไม่สามารถปรับได้`
*   **ส้ม:** `มีแผนจะปรับ`
*   **แดง:** `ล้มเหลว`
*   **เขียว:** `มีความพร้อมแล้ว`

นำตารางนี้โหลดเข้าสู่ Power BI Desktop ของคุณ

---

### ขั้นตอนที่ 2: สร้าง DAX Measures เพื่อกำหนดรหัสสี

นี่คือขั้นตอนที่สำคัญที่สุด เราจะสร้าง Measure แยกสำหรับ **แต่ละ Block** ที่เราต้องการจะแสดงใน Diagram

สมมติว่าเราต้องการสร้าง Block สำหรับกระบวนการ "การจัดการเอกสาร"

1.  ไปที่หน้า Report View ใน Power BI
2.  คลิกขวาที่ตาราง `DT_Readiness` ในบานหน้าต่าง Fields แล้วเลือก **New measure**
3.  ในแถบสูตร ให้ตั้งชื่อ Measure และใส่สูตร DAX ดังนี้:

    ```dax
    Color_การจัดการเอกสาร =
    VAR CurrentStatus =
        CALCULATE(
            SELECTEDVALUE('DT_Readiness'[Status]),
            'DT_Readiness'[ProcessName] = "การจัดการเอกสาร"
        )
    RETURN
        SWITCH(
            TRUE(),
            CurrentStatus = "มีความพร้อมแล้ว", "#28a745",  // สีเขียว
            CurrentStatus = "มีแผนจะปรับ", "#ffc107",      // สีส้ม
            CurrentStatus = "ล้มเหลว", "#dc3545",          // สีแดง
            CurrentStatus = "ไม่สามารถปรับได้", "#6c757d", // สีเทา
            "#FFFFFF" // สีขาว (เป็นค่า Default หากไม่ตรงเงื่อนไข)
        )
    ```

**คำอธิบายสูตร:**
*   `VAR CurrentStatus = ...`: เราสร้างตัวแปรชื่อ `CurrentStatus` เพื่อเก็บค่าสถานะของกระบวนการที่เราสนใจ
*   `CALCULATE(SELECTEDVALUE(...), ...)`: เป็นการดึงค่าสถานะ (`Status`) จากตาราง โดย Filter ให้เหลือเฉพาะแถวที่ `ProcessName` เท่ากับ "การจัดการเอกสาร"
*   `RETURN SWITCH(TRUE(), ...)`: เป็นการคืนค่ารหัสสี (Hex Code) ตามเงื่อนไขของ `CurrentStatus` ที่ได้มา

**สิ่งที่ต้องทำ:**
คุณต้อง **สร้าง Measure ใหม่สำหรับทุกๆ Block** ที่คุณต้องการใน Diagram โดยแค่คัดลอกสูตรข้างบน แล้วเปลี่ยนชื่อ Measure และชื่อ `ProcessName` ในสูตรเท่านั้น

**ตัวอย่าง Measure ที่สอง สำหรับ "การอนุมัติคำสั่งซื้อ":**
```dax
Color_การอนุมัติคำสั่งซื้อ =
VAR CurrentStatus =
    CALCULATE(
        SELECTEDVALUE('DT_Readiness'[Status]),
        'DT_Readiness'[ProcessName] = "การอนุมัติคำสั่งซื้อ"
    )
RETURN
    SWITCH(
        TRUE(),
        CurrentStatus = "มีความพร้อมแล้ว", "#28a745",
        CurrentStatus = "มีแผนจะปรับ", "#ffc107",
        CurrentStatus = "ล้มเหลว", "#dc3545",
        CurrentStatus = "ไม่สามารถปรับได้", "#6c757d",
        "#FFFFFF"
    )
```

ทำเช่นนี้ไปจนครบทุกกระบวนการที่คุณต้องการแสดงผล

---

### ขั้นตอนที่ 3: ออกแบบ Block Diagram บน Report Canvas

1.  ไปที่แท็บ **Insert** บน Ribbon menu
2.  เลือก **Shapes** -> **Rectangle** (สี่เหลี่ยม)
3.  ปรับขนาดและจัดวางตำแหน่งสี่เหลี่ยมบน Canvas ตามที่คุณต้องการ ทำซ้ำสำหรับทุก Block
4.  คุณสามารถเพิ่ม **Text box** เพื่อใส่ชื่อกระบวนการกำกับแต่ละ Block ได้

ตอนนี้คุณจะมี Layout ของ Diagram เป็นรูปทรงสีพื้นฐาน (ปกติคือสีน้ำเงิน)



---

### ขั้นตอนที่ 4: ผูกสีของ Shape เข้ากับ DAX Measure (Conditional Formatting)

นี่คือขั้นตอนสุดท้ายที่จะทำให้ Diagram ของเรามีชีวิต

1.  **เลือก Shape แรก** (เช่น Block ที่แทน "การจัดการเอกสาร")
2.  ในบานหน้าต่าง **Format** (ถ้าไม่เห็น ให้ไปที่ View -> Format) ให้เปิดส่วนของ **Style**
3.  หาหัวข้อ **Fill** แล้วคลิกที่ปุ่ม **`fx`** ที่อยู่ข้างๆ ตัวเลือก Color

    

4.  หน้าต่าง Conditional formatting จะปรากฏขึ้นมา ให้ตั้งค่าดังนี้:
    *   **Format style:** เลือก **Field value**
    *   **What field should we base this on?:** เลือก Measure ที่คุณสร้างไว้สำหรับ Block นี้ ในที่นี้คือ `Color_การจัดการเอกสาร`

    

5.  คลิก **OK**

สีของ Shape แรกจะเปลี่ยนเป็นสีเขียวทันที (ตามข้อมูลตัวอย่าง)

**ทำซ้ำขั้นตอนที่ 1-5 กับทุกๆ Shape** โดยจับคู่ Shape ให้ตรงกับ Measure ของมัน เช่น:
*   Shape "การอนุมัติคำสั่งซื้อ" ต้องผูกกับ Measure `Color_การอนุมัติคำสั่งซื้อ`
*   Shape "ระบบบัญชีเจ้าหนี้" ต้องผูกกับ Measure `Color_ระบบบัญชีเจ้าหนี้`

### ผลลัพธ์ที่ได้

เมื่อคุณทำครบทุก Block คุณจะได้ Diagram ที่สีของแต่ละ Block ถูกควบคุมโดยข้อมูลในตาราง `DT_Readiness` โดยสมบูรณ์ **เมื่อใดก็ตามที่ข้อมูลในตารางนั้นมีการเปลี่ยนแปลง (เช่น Refresh Data) สีบน Diagram ของคุณก็จะอัปเดตตามโดยอัตโนมัติ**



### เคล็ดลับเพิ่มเติม (Pro-Tips)

*   **จัดกลุ่ม (Grouping):** หลังจากจัดวาง Shapes และ Text boxes ทั้งหมดเรียบร้อยแล้ว ให้กด Ctrl ค้างไว้แล้วเลือกทุกองค์ประกอบของ Diagram จากนั้นคลิกขวา -> **Group** -> **Group** เพื่อรวมเป็นวัตถุชิ้นเดียว จะทำให้ย้ายหรือปรับขนาดได้สะดวก
*   **ตาราง Measures:** เพื่อความเป็นระเบียบ คุณสามารถสร้างตารางว่างสำหรับเก็บ Measures โดยเฉพาะได้ โดยไปที่ Home -> Enter Data -> ตั้งชื่อตาราง (เช่น `_Measures`) แล้วกด Load จากนั้นย้าย Measures ทั้งหมดไปไว้ในตารางนั้น
*   **ใช้ Custom Visuals:** หาก Diagram ของคุณซับซ้อนมาก การสร้างทีละ Shape อาจไม่สะดวก ลองพิจารณาใช้ Custom Visual จาก AppSource เช่น **Synoptic Panel by OKViz** ซึ่งอนุญาตให้คุณอัปโหลดภาพ SVG ของ Diagram แล้ว Map สีเข้ากับแต่ละส่วนของภาพได้ ซึ่งจะยืดหยุ่นกว่ามากสำหรับกรณีที่ซับซ้อน
